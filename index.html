<!DOCTYPE html>

<script type="module">
import {Bungie} from './bungie.js';


(async function() {

let bungie = window.bungie = new Bungie();

await bungie.login();

let user = await bungie.getCurrentUser();
console.log('user = %o', user);

let characters = await user.primaryMembership.getCharacters();
console.log('characters = %o', characters);

for (let [characterId, character] of Object.entries(characters)) {
  document.body.appendChild(character.buildEmblem());
  let ul = document.body.appendChild(document.createElement('ul'));
  for (let [bucketHash, items] of Object.entries(character.getItemsByBucket())) {
    let li = ul.appendChild(document.createElement('li'));
    let bucketDef = await bungie.getDef('InventoryBucket', bucketHash);
    let title = bucketDef.displayProperties.name || `Bucket ${bucketHash}`;
    if (bucketDef.displayProperties.description)
      title = `${title} \u2014 ${bucketDef.displayProperties.description}`;
    let div = li.appendChild(document.createElement('div'));
    div.textContent = title;
    div.addEventListener('click', e => console.log(bucketDef));

    for (let item of items) {
      let itemDef = await bungie.getDef('InventoryItemLite', item.itemHash);
      let img = li.appendChild(document.createElement('img'));
      img.src = `https://www.bungie.net${itemDef.displayProperties.icon}`;
      img.width = img.height = 96;
      let title = itemDef.displayProperties.name || `Item ${item.itemHash}`;
      if (itemDef.displayProperties.description)
        title = `${title}\n\n${itemDef.displayProperties.description}`;
      img.title = title;
      img.addEventListener('click', e => {console.log(item); console.log(itemDef)});
    }
  }
}


})();
</script>
